!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},r=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};function n(e,t,r,n){t&&(t.textContent=e?n:r)}let o=null,a=null,l=null;const s=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){return fetch(`${this._baseUrl}${e}`,{headers:this._headers,...t}).then(e=>this._checkResponse(e))}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getUserInfo(){return this._request("/users/me")}setUpdateUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}getInitialCards(){return this._request("/cards")}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}changeLikeCardStatus(e,t){return this._request(`/cards/${e}/likes`,{method:t?"PUT":"DELETE"})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"cf143ddc-e5b7-44f2-b563-374f81cfb9fa","Content-Type":"application/json"}}),c=document.querySelector(".profile__edit-button"),i=document.querySelector("#edit-profile-modal"),d=i.querySelector(".modal__close-button"),u=i.querySelector(".modal__form"),m=i.querySelector("#profile-name-input"),_=i.querySelector("#profile-description-input"),v=u.querySelector(".modal__submit-button"),S=document.querySelector("#new-post-modal"),y=S.querySelector(".modal__form"),p=S.querySelector("#card-caption-input"),f=S.querySelector("#card-image-input"),b=document.querySelector(".profile__add-button"),q=y.querySelector(".modal__submit-button"),h=S.querySelector(".modal__close-button"),L=document.querySelector(".profile__avatar-button"),E=document.querySelector("#preview-modal"),k=E.querySelector(".modal__close-button"),C=E.querySelector(".modal__image"),g=E.querySelector(".modal__caption"),w=document.querySelector(".profile__name"),x=document.querySelector(".profile__description"),U=document.querySelector(".profile__avatar"),A=document.querySelector("#delete-card-modal"),D=A?A.querySelector(".modal__form"):null,I=D?D.querySelector(".modal__submit-button"):null,B=A?A.querySelector(".modal__close-button"):null,T=document.querySelector("#delete-cancel-button"),$=document.querySelector("#avatar-modal"),P=$?$.querySelector(".modal__form"):null,j=P?P.querySelector("#avatar-link-input"):null,N=P?P.querySelector(".modal__submit-button"):null,O=$?$.querySelector(".modal__close-button"):null,J=document.querySelector("#card-template"),H=document.querySelector(".cards__list");function R(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&M(e)}}function Y(e){e.target.classList.contains("modal")&&M(e.target)}function z(e){e.classList.add("modal_is-opened"),e.addEventListener("mousedown",Y),document.addEventListener("keydown",R)}function M(e){e.classList.remove("modal_is-opened"),e.removeEventListener("mousedown",Y),document.removeEventListener("keydown",R)}function F(e){const t=J.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),c=t.querySelector(".card__link-button"),i=t.querySelector(".card__delete-button");n.src=e.link,n.alt=e.name,r.textContent=e.name;const d=e.owner&&"object"==typeof e.owner?e.owner._id:e.owner;return d&&o&&d!==o&&(i.style.display="none"),Boolean(e.isLiked)&&c.classList.add("card__link-button_active"),c.addEventListener("click",()=>{const t=!c.classList.contains("card__link-button_active");s.changeLikeCardStatus(e._id,t).then(e=>{e.isLiked?c.classList.add("card__link-button_active"):c.classList.remove("card__link-button_active")}).catch(console.error)}),i.addEventListener("click",()=>{!function(e,t){a=e,l=t._id,z(A)}(t,e)}),n.addEventListener("click",()=>{C.src=e.link,g.textContent=e.name,C.alt=e.name,z(E)}),t}var G;u.addEventListener("submit",e=>{e.preventDefault();const t=m.value,r=_.value;n(!0,v,"Save","Saving..."),s.setUpdateUserInfo({name:t,about:r}).then(e=>{w.textContent=e.name,x.textContent=e.about,M(i)}).catch(console.error).finally(()=>{n(!1,v,"Save","Saving...")})}),y.addEventListener("submit",t=>{t.preventDefault();const o=p.value,a=f.value;n(!0,q,"Save","Saving..."),s.addCard({name:o,link:a}).then(t=>{!function(e){const t=F(e);H.prepend(t)}(t),y.reset(),r(q,e),M(S)}).catch(console.error).finally(()=>{n(!1,q,"Save","Saving...")})}),P&&j&&N&&P.addEventListener("submit",t=>{t.preventDefault();const o=j.value;n(!0,N,"Save","Saving..."),s.updateAvatar(o).then(t=>{U.src=t.avatar,P.reset(),r(N,e),M($)}).catch(console.error).finally(()=>{n(!1,N,"Save","Saving...")})}),D&&I&&D.addEventListener("submit",e=>{e.preventDefault(),l&&(n(!0,I,"Yes, delete","Deleting..."),s.deleteCard(l).then(()=>{a&&a.remove(),a=null,l=null,M(A)}).catch(console.error).finally(()=>{n(!1,I,"Yes, delete","Deleting...")}))}),c.addEventListener("click",()=>{m.value=w.textContent,_.value=x.textContent,z(i)}),d.addEventListener("click",()=>{M(i)}),b.addEventListener("click",()=>{y.reset(),r(q,e),z(S)}),h.addEventListener("click",()=>{M(S)}),L&&$&&P&&N&&L.addEventListener("click",()=>{P.reset(),r(N,e),z($)}),O&&O.addEventListener("click",()=>{M($)}),B&&B.addEventListener("click",()=>{M(A)}),T&&T.addEventListener("click",()=>{M(A)}),k.addEventListener("click",()=>{M(E)}),s.getAppInfo().then(([e,t])=>{o=e._id,w.textContent=e.name,x.textContent=e.about,U.src=e.avatar,t.forEach(e=>{!function(e){const t=F(e);H.append(t)}(e)})}).catch(console.error),G=e,document.querySelectorAll(G.formSelector).forEach(e=>{((e,r)=>{const n=Array.from(e.querySelectorAll(r.inputSelector)),o=e.querySelector(r.submitButtonSelector);t(n,o,r),n.forEach(a=>{a.addEventListener("input",()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);n&&(n.textContent="",n.classList.remove(r.errorClass)),t.classList.remove(r.inputErrorClass)})(e,t,r):((e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);n&&(n.textContent=t.validationMessage,n.classList.add(r.errorClass)),t.classList.add(r.inputErrorClass)})(e,t,r)})(e,a,r),t(n,o,r)})})})(e,G)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQVEvSSxVQUFVRSxPQUFPVCxFQUFPTCxrQkFPOUI2SixDQUFlTixFQUFRSSxFQUFTdEosR0F0QmIySixFQUFDVCxFQUFRSSxFQUFTdEosS0FDdkMsTUFBTXlKLEVBQWFQLEVBQU9wRixjQUFlLElBQUd3RixFQUFRSSxZQUNoREQsSUFDRkEsRUFBV3pJLFlBQWNzSSxFQUFRTSxrQkFDakNILEVBQVdsSixVQUFVQyxJQUFJUixFQUFPSixhQUVsQzBKLEVBQVEvSSxVQUFVQyxJQUFJUixFQUFPTCxrQkFjM0JnSyxDQUFlVCxFQUFRSSxFQUFTdEosSUErQjlCdUosQ0FBbUJMLEVBQVFJLEVBQVN0SixHQUNwQ0gsRUFBa0JDLEVBQVdDLEVBQVVDLFFBUXpDbUosQ0FBaUJELEVBQVFsSixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2VicGFjay1kZW1vLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJwYWNrLWRlbW8vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2VicGFjay1kZW1vLy4vc3JjL3V0aWwvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBpZiAoZXJyb3JNc2dFbCkge1xuICAgIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xuICAgIGVycm9yTXNnRWwuY2xhc3NMaXN0LmFkZChjb25maWcuZXJyb3JDbGFzcyk7XG4gIH1cbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBpZiAoZXJyb3JNc2dFbCkge1xuICAgIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yTXNnRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG4gIH1cbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZCk7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5leHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVyID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVyKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuIiwiaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbC9BcGkuanNcIjtcbmltcG9ydCBcIi4uL3BhZ2VzL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgdmFsaWRhdGlvbkNvbmZpZyxcbiAgZGlzYWJsZUJ1dHRvbixcbiAgZW5hYmxlVmFsaWRhdGlvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvblwiO1xuXG4vLyAtLS0tLS0tLS0gSEVMUEVSIEZPUiBcIlNhdmluZy4uLlwiIC8gXCJEZWxldGluZy4uLlwiIC0tLS0tLS0tLVxuZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGJ1dHRvbiwgZGVmYXVsdFRleHQsIGxvYWRpbmdUZXh0KSB7XG4gIGlmICghYnV0dG9uKSByZXR1cm47XG4gIGJ1dHRvbi50ZXh0Q29udGVudCA9IGlzTG9hZGluZyA/IGxvYWRpbmdUZXh0IDogZGVmYXVsdFRleHQ7XG59XG5cbi8vIC0tLS0tLS0tLSBHTE9CQUwgU1RBVEUgLS0tLS0tLS0tXG5sZXQgY3VycmVudFVzZXJJZCA9IG51bGw7XG5sZXQgc2VsZWN0ZWRDYXJkID0gbnVsbDtcbmxldCBzZWxlY3RlZENhcmRJZCA9IG51bGw7XG5cbi8vIC0tLS0tLS0tLSBBUEkgSU5TVEFOQ0UgLS0tLS0tLS0tXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCJjZjE0M2RkYy1lNWI3LTQ0ZjItYjU2My0zNzRmODFjZmI5ZmFcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyAtLS0tLS0tLS0gRE9NIEVMRU1FTlRTIC0tLS0tLS0tLVxuXG4vLyBQcm9maWxlIG1vZGFsXG5jb25zdCBlZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBlZGl0UHJvZmlsZUNsb3NlQnV0dG9uID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIsXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiLFxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiLFxuKTtcbmNvbnN0IGVkaXRQcm9maWxlU3VibWl0QnV0dG9uID0gZWRpdFByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXG4pO1xuXG4vLyBOZXcgcG9zdCAoY2FyZCkgbW9kYWxcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBhZGRDYXJkRm9ybUVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBuZXdQb3N0Q2FwdGlvbklucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1jYXB0aW9uLWlucHV0XCIpO1xuY29uc3QgbmV3UG9zdEltYWdlSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltYWdlLWlucHV0XCIpO1xuY29uc3QgbmV3UG9zdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGNhcmRTdWJtaXRCdXR0b24gPSBhZGRDYXJkRm9ybUVsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdXR0b24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpO1xuXG4vLyBBdmF0YXIgZWRpdFxuY29uc3QgYXZhdGFyRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiKTtcblxuLy8gUHJldmlldyBtb2RhbFxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0Nsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcbmNvbnN0IHByZXZpZXdJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld05hbWVFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBQcm9maWxlIHRleHQgKyBhdmF0YXIgb24gcGFnZVxuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuXG4vLyBEZWxldGUgY29uZmlybWF0aW9uIHBvcHVwXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWNhcmQtbW9kYWxcIik7XG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWxcbiAgPyBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpXG4gIDogbnVsbDtcbmNvbnN0IGRlbGV0ZVN1Ym1pdEJ1dHRvbiA9IGRlbGV0ZUZvcm1cbiAgPyBkZWxldGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIilcbiAgOiBudWxsO1xuY29uc3QgZGVsZXRlQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbFxuICA/IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKVxuICA6IG51bGw7XG5jb25zdCBjYW5jZWxEZWxldGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYW5jZWwtYnV0dG9uXCIpO1xuXG4vLyBBdmF0YXIgbW9kYWxcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWxcbiAgPyBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpXG4gIDogbnVsbDtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyRm9ybVxuICA/IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbGluay1pbnB1dFwiKVxuICA6IG51bGw7XG5jb25zdCBhdmF0YXJTdWJtaXRCdXR0b24gPSBhdmF0YXJGb3JtXG4gID8gYXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpXG4gIDogbnVsbDtcbmNvbnN0IGF2YXRhckNsb3NlQnV0dG9uID0gYXZhdGFyTW9kYWxcbiAgPyBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIilcbiAgOiBudWxsO1xuXG4vLyBDYXJkc1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuLy8gLS0tLS0tLS0tIE1PREFMIEhFTFBFUlMgLS0tLS0tLS0tXG5cbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGlmIChvcGVuZWRNb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChvcGVuZWRNb2RhbCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZU92ZXJsYXlDbG9zZShldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGhhbmRsZU92ZXJsYXlDbG9zZSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVPdmVybGF5Q2xvc2UpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG4vLyAtLS0tLS0tLS0gQ0FSRCBIRUxQRVJTIC0tLS0tLS0tLVxuXG4vLyBGb3IgdGhpcyBBUEksIGlzTGlrZWQgaXMgYSBib29sZWFuIG9uIHRoZSBjYXJkIG9iamVjdFxuZnVuY3Rpb24gaXNDYXJkTGlrZWQoY2FyZCkge1xuICByZXR1cm4gQm9vbGVhbihjYXJkLmlzTGlrZWQpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICBjb25zdCBjYXJkVGl0bGVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgbGlrZUJ1dHRvbkVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saW5rLWJ1dHRvblwiKTtcbiAgY29uc3QgZGVsZXRlQnV0dG9uRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG5cbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIC8vIE93bmVyIG1heSBiZSBhbiBJRCBzdHJpbmcgb3IgYW4gb2JqZWN0LCBoYW5kbGUgYm90aCBkZWZlbnNpdmVseVxuICBjb25zdCBvd25lcklkID1cbiAgICBkYXRhLm93bmVyICYmIHR5cGVvZiBkYXRhLm93bmVyID09PSBcIm9iamVjdFwiID8gZGF0YS5vd25lci5faWQgOiBkYXRhLm93bmVyO1xuXG4gIGlmIChvd25lcklkICYmIGN1cnJlbnRVc2VySWQgJiYgb3duZXJJZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgIGRlbGV0ZUJ1dHRvbkVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxuXG4gIGlmIChpc0NhcmRMaWtlZChkYXRhKSkge1xuICAgIGxpa2VCdXR0b25FbC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGluay1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgbGlrZUJ1dHRvbkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3Qgc2hvdWxkTGlrZSA9ICFsaWtlQnV0dG9uRWwuY2xhc3NMaXN0LmNvbnRhaW5zKFxuICAgICAgXCJjYXJkX19saW5rLWJ1dHRvbl9hY3RpdmVcIixcbiAgICApO1xuXG4gICAgYXBpXG4gICAgICAuY2hhbmdlTGlrZUNhcmRTdGF0dXMoZGF0YS5faWQsIHNob3VsZExpa2UpXG4gICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcbiAgICAgICAgaWYgKHVwZGF0ZWRDYXJkLmlzTGlrZWQpIHtcbiAgICAgICAgICBsaWtlQnV0dG9uRWwuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpbmstYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsaWtlQnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpbmstYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSk7XG5cbiAgZGVsZXRlQnV0dG9uRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBwcmV2aWV3SW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gICAgcHJldmlld05hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3SW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gYWRkQ2FyZFRvU3RhcnQoY2FyZERhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkRGF0YSk7XG4gIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gYWRkQ2FyZFRvRW5kKGNhcmREYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbn1cblxuLy8gLS0tLS0tLS0tIEZPUk0gSEFORExFUlMgLS0tLS0tLS0tXG5cbi8vIEVkaXQgcHJvZmlsZVxuZWRpdFByb2ZpbGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBuYW1lID0gZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWU7XG4gIGNvbnN0IGFib3V0ID0gZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlO1xuXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgZWRpdFByb2ZpbGVTdWJtaXRCdXR0b24sIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcblxuICBhcGlcbiAgICAuc2V0VXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KVxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIGVkaXRQcm9maWxlU3VibWl0QnV0dG9uLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG4gICAgfSk7XG59KTtcblxuLy8gQWRkIG5ldyBjYXJkXG5hZGRDYXJkRm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBuYW1lID0gbmV3UG9zdENhcHRpb25JbnB1dC52YWx1ZTtcbiAgY29uc3QgbGluayA9IG5ld1Bvc3RJbWFnZUlucHV0LnZhbHVlO1xuXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgY2FyZFN1Ym1pdEJ1dHRvbiwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xuXG4gIGFwaVxuICAgIC5hZGRDYXJkKHsgbmFtZSwgbGluayB9KVxuICAgIC50aGVuKChuZXdDYXJkKSA9PiB7XG4gICAgICBhZGRDYXJkVG9TdGFydChuZXdDYXJkKTtcbiAgICAgIGFkZENhcmRGb3JtRWwucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oY2FyZFN1Ym1pdEJ1dHRvbiwgdmFsaWRhdGlvbkNvbmZpZyk7XG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBjYXJkU3VibWl0QnV0dG9uLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG4gICAgfSk7XG59KTtcblxuLy8gVXBkYXRlIGF2YXRhclxuaWYgKGF2YXRhckZvcm0gJiYgYXZhdGFySW5wdXQgJiYgYXZhdGFyU3VibWl0QnV0dG9uKSB7XG4gIGF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJJbnB1dC52YWx1ZTtcblxuICAgIHJlbmRlckxvYWRpbmcodHJ1ZSwgYXZhdGFyU3VibWl0QnV0dG9uLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG5cbiAgICBhcGlcbiAgICAgIC51cGRhdGVBdmF0YXIoYXZhdGFyVXJsKVxuICAgICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICAgIHByb2ZpbGVBdmF0YXJFbC5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XG4gICAgICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcbiAgICAgICAgZGlzYWJsZUJ1dHRvbihhdmF0YXJTdWJtaXRCdXR0b24sIHZhbGlkYXRpb25Db25maWcpO1xuICAgICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgYXZhdGFyU3VibWl0QnV0dG9uLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8vIERlbGV0ZSBjYXJkIChjb25maXJtKVxuaWYgKGRlbGV0ZUZvcm0gJiYgZGVsZXRlU3VibWl0QnV0dG9uKSB7XG4gIGRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCFzZWxlY3RlZENhcmRJZCkgcmV0dXJuO1xuXG4gICAgcmVuZGVyTG9hZGluZyh0cnVlLCBkZWxldGVTdWJtaXRCdXR0b24sIFwiWWVzLCBkZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcblxuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChzZWxlY3RlZENhcmQpIHtcbiAgICAgICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZWN0ZWRDYXJkID0gbnVsbDtcbiAgICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgZGVsZXRlU3VibWl0QnV0dG9uLCBcIlllcywgZGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8vIC0tLS0tLS0tLSBCVVRUT04gLyBNT0RBTCBPUEVOICYgQ0xPU0UgTElTVEVORVJTIC0tLS0tLS0tLVxuXG4vLyBPcGVuIHByb2ZpbGUgZWRpdFxuZWRpdFByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbi8vIENsb3NlIHByb2ZpbGUgZWRpdFxuZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbi8vIE9wZW4gbmV3IHBvc3Rcbm5ld1Bvc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkQ2FyZEZvcm1FbC5yZXNldCgpO1xuICBkaXNhYmxlQnV0dG9uKGNhcmRTdWJtaXRCdXR0b24sIHZhbGlkYXRpb25Db25maWcpO1xuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG4vLyBDbG9zZSBuZXcgcG9zdFxubmV3UG9zdENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG4vLyBPcGVuIGF2YXRhciBtb2RhbCBmcm9tIGF2YXRhciBidXR0b25cbmlmIChhdmF0YXJFZGl0QnV0dG9uICYmIGF2YXRhck1vZGFsICYmIGF2YXRhckZvcm0gJiYgYXZhdGFyU3VibWl0QnV0dG9uKSB7XG4gIGF2YXRhckVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhdmF0YXJGb3JtLnJlc2V0KCk7XG4gICAgZGlzYWJsZUJ1dHRvbihhdmF0YXJTdWJtaXRCdXR0b24sIHZhbGlkYXRpb25Db25maWcpO1xuICAgIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG4gIH0pO1xufVxuXG4vLyBDbG9zZSBhdmF0YXIgbW9kYWxcbmlmIChhdmF0YXJDbG9zZUJ1dHRvbikge1xuICBhdmF0YXJDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICB9KTtcbn1cblxuLy8gQ2xvc2UgZGVsZXRlIG1vZGFsIGZyb20gWCBidXR0b25cbmlmIChkZWxldGVDbG9zZUJ1dHRvbikge1xuICBkZWxldGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcbn1cblxuLy8gQ2xvc2UgZGVsZXRlIG1vZGFsIGZyb20gQ2FuY2VsIGJ1dHRvblxuaWYgKGNhbmNlbERlbGV0ZUJ1dHRvbikge1xuICBjYW5jZWxEZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgfSk7XG59XG5cbi8vIENsb3NlIGltYWdlIHByZXZpZXdcbnByZXZpZXdDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuLy8gLS0tLS0tLS0tIElOSVRJQUwgREFUQSBMT0FEIC0tLS0tLS0tLVxuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdKSA9PiB7XG4gICAgY3VycmVudFVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcblxuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgcHJvZmlsZUF2YXRhckVsLnNyYyA9IHVzZXJEYXRhLmF2YXRhcjtcblxuICAgIGluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBhZGRDYXJkVG9FbmQoY2FyZCk7XG4gICAgfSk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy8gLS0tLS0tLS0tIEVOQUJMRSBGT1JNIFZBTElEQVRJT04gLS0tLS0tLS0tXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIC8vIENoZWNrIHNlcnZlciByZXNwb25zZVxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgLy8gVW5pdmVyc2FsIHJlcXVlc3QgaGVscGVyXG4gIF9yZXF1ZXN0KHBhdGgsIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfSR7cGF0aH1gLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICAvLyBMb2FkIHVzZXIgaW5mbyArIGNhcmRzIHRvZ2V0aGVyXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tIFVTRVIgTUVUSE9EUyAtLS0tLS0tLVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KFwiL3VzZXJzL21lXCIpO1xuICB9XG5cbiAgc2V0VXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvdXNlcnMvbWVcIiwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGFib3V0IH0pLFxuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlQXZhdGFyKGF2YXRhclVybCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KFwiL3VzZXJzL21lL2F2YXRhclwiLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyOiBhdmF0YXJVcmwgfSksXG4gICAgfSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLSBDQVJEIE1FVEhPRFMgLS0tLS0tLS1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvY2FyZHNcIik7XG4gIH1cblxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvY2FyZHNcIiwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgfSk7XG4gIH1cblxuICBjaGFuZ2VMaWtlQ2FyZFN0YXR1cyhjYXJkSWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiUFVUXCIgOiBcIkRFTEVURVwiLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwiY29uZmlnIiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiZGlzYWJsZUJ1dHRvbiIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJidXR0b24iLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJjdXJyZW50VXNlcklkIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfcmVxdWVzdCIsInBhdGgiLCJvcHRpb25zIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldFVzZXJJbmZvIiwiZ2V0SW5pdGlhbENhcmRzIiwic2V0VXBkYXRlVXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZUF2YXRhciIsImF2YXRhclVybCIsImF2YXRhciIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUxpa2VDYXJkU3RhdHVzIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJlZGl0UHJvZmlsZUJ1dHRvbiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUNsb3NlQnV0dG9uIiwiZWRpdFByb2ZpbGVGb3JtIiwiZWRpdFByb2ZpbGVOYW1lSW5wdXQiLCJlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQiLCJlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiIsIm5ld1Bvc3RNb2RhbCIsImFkZENhcmRGb3JtRWwiLCJuZXdQb3N0Q2FwdGlvbklucHV0IiwibmV3UG9zdEltYWdlSW5wdXQiLCJuZXdQb3N0QnV0dG9uIiwiY2FyZFN1Ym1pdEJ1dHRvbiIsIm5ld1Bvc3RDbG9zZUJ1dHRvbiIsImF2YXRhckVkaXRCdXR0b24iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3Q2xvc2VCdG4iLCJwcmV2aWV3SW1hZ2VFbCIsInByZXZpZXdOYW1lRWwiLCJwcm9maWxlTmFtZUVsIiwicHJvZmlsZURlc2NyaXB0aW9uRWwiLCJwcm9maWxlQXZhdGFyRWwiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVTdWJtaXRCdXR0b24iLCJkZWxldGVDbG9zZUJ1dHRvbiIsImNhbmNlbERlbGV0ZUJ1dHRvbiIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhcklucHV0IiwiYXZhdGFyU3VibWl0QnV0dG9uIiwiYXZhdGFyQ2xvc2VCdXR0b24iLCJjYXJkVGVtcGxhdGUiLCJjYXJkc0xpc3QiLCJoYW5kbGVFc2NhcGUiLCJldnQiLCJrZXkiLCJvcGVuZWRNb2RhbCIsImNsb3NlTW9kYWwiLCJoYW5kbGVPdmVybGF5Q2xvc2UiLCJ0YXJnZXQiLCJjb250YWlucyIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJnZXRDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwibGlrZUJ1dHRvbkVsIiwiZGVsZXRlQnV0dG9uRWwiLCJzcmMiLCJhbHQiLCJvd25lcklkIiwib3duZXIiLCJfaWQiLCJzdHlsZSIsImRpc3BsYXkiLCJCb29sZWFuIiwic2hvdWxkTGlrZSIsInVwZGF0ZWRDYXJkIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJoYW5kbGVEZWxldGVDYXJkIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInVzZXJEYXRhIiwiZmluYWxseSIsIm5ld0NhcmQiLCJjYXJkRGF0YSIsInByZXBlbmQiLCJhZGRDYXJkVG9TdGFydCIsInJlc2V0IiwiaW5pdGlhbENhcmRzIiwiZm9yRWFjaCIsImNhcmQiLCJhcHBlbmQiLCJhZGRDYXJkVG9FbmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9ybUVsIiwic2V0RXZlbnRMaXN0ZW5lciIsIkFycmF5IiwiZnJvbSIsImlucHV0RWwiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJoaWRlSW5wdXRFcnJvciIsImVycm9yTXNnRWwiLCJpZCIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==